<div class="auth-page">
  <a routerLink="/" class="back-link">← Back to Home</a>

  <div class="auth-card">
    <div class="auth-header">
      <h1>Join Freelancia</h1>
      <p class="subtitle">Create your account and start collaborating</p>
    </div>

    @if (errorMessage) {
      <div class="error-banner" role="alert">
        {{ errorMessage }}
      </div>
    }
    @if (successMessage) {
      <div class="success-banner" role="status">
        {{ successMessage }}
      </div>
    }

    <form [formGroup]="form" (ngSubmit)="onSubmit()">
      <div class="field">
        <label for="email">Email</label>
        <input
          id="email"
          type="email"
          formControlName="email"
          placeholder="you@example.com"
          autocomplete="email"
          [attr.aria-invalid]="form.get('email')?.invalid && form.get('email')?.touched"
          aria-describedby="email-error"
          [class.input-error]="form.get('email')?.invalid && form.get('email')?.touched"
        />
        @if (getEmailError(); as msg) {
          <span id="email-error" class="field-error">{{ msg }}</span>
        }
      </div>

      <div class="field">
        <label for="password">Password</label>
        <input
          id="password"
          type="password"
          formControlName="password"
          placeholder="At least 8 characters"
          autocomplete="new-password"
          [attr.aria-invalid]="form.get('password')?.invalid && form.get('password')?.touched"
          aria-describedby="password-error"
          [class.input-error]="form.get('password')?.invalid && form.get('password')?.touched"
        />
        @if (getPasswordError(); as msg) {
          <span id="password-error" class="field-error">{{ msg }}</span>
        }
      </div>

      <div class="row">
        <div class="field half">
          <label for="firstName">First name</label>
          <input
            id="firstName"
            type="text"
            formControlName="firstName"
            placeholder="John"
            [attr.aria-invalid]="form.get('firstName')?.invalid && form.get('firstName')?.touched"
            [class.input-error]="form.get('firstName')?.invalid && form.get('firstName')?.touched"
          />
          @if (getFirstNameError(); as msg) {
            <span class="field-error">{{ msg }}</span>
          }
        </div>
        <div class="field half">
          <label for="lastName">Last name</label>
          <input
            id="lastName"
            type="text"
            formControlName="lastName"
            placeholder="Doe"
            [attr.aria-invalid]="form.get('lastName')?.invalid && form.get('lastName')?.touched"
            [class.input-error]="form.get('lastName')?.invalid && form.get('lastName')?.touched"
          />
          @if (getLastNameError(); as msg) {
            <span class="field-error">{{ msg }}</span>
          }
        </div>
      </div>

      <div class="field">
        <label for="phone">Phone (optional)</label>
        <input
          id="phone"
          type="tel"
          formControlName="phone"
          placeholder="+1234567890"
          autocomplete="tel"
          maxlength="20"
        />
      </div>

      <div class="field avatar-field">
        <label>Profile image (optional)</label>
        <div class="avatar-upload-row">
          <input
            type="file"
            #avatarFileInput
            accept="image/jpeg,image/png,image/gif,image/webp"
            (change)="onAvatarFileSelected($event)"
            class="avatar-file-input"
            [disabled]="avatarUploading"
          />
          <button type="button" class="btn-upload" (click)="avatarFileInput.click()" [disabled]="avatarUploading">
            {{ avatarUploading ? 'Uploading…' : 'Upload image' }}
          </button>
          <span class="avatar-or">or paste URL</span>
          <input
            id="avatarUrl"
            type="url"
            formControlName="avatarUrl"
            placeholder="https://..."
            class="avatar-url-input"
          />
        </div>
        @if (avatarPreviewUrl) {
          <div class="avatar-preview">
            <img [src]="avatarPreviewUrl" alt="Preview" (error)="$any($event.target).style.display='none'" />
            @if (pendingAvatarFile) {
              <button type="button" class="avatar-remove" (click)="clearPendingAvatar()">Remove image</button>
            }
          </div>
        }
      </div>

      <div class="field">
        <label for="role">I want to join as</label>
        <select id="role" formControlName="role">
          @for (r of roles; track r) {
            <option [value]="r">
              @if (r === 'CLIENT') { Client - Hire Talent }
              @else if (r === 'FREELANCER') { Freelancer - Find Work }
              @else { {{ r }} }
            </option>
          }
        </select>
      </div>

      <button type="submit" class="btn-primary" [disabled]="loading || checkingEmail || avatarUploading">
        @if (checkingEmail) {
          Checking email…
        } @else if (loading) {
          Creating account…
        } @else if (avatarUploading) {
          Adding profile image…
        } @else {
          Create account
        }
      </button>
    </form>

    <p class="switch-link">
      Already have an account? <a routerLink="/login">Log in</a>
    </p>
  </div>
</div>
