<section class="project-details">

  <!-- LOADING -->
  <div *ngIf="isLoading" class="loading">
    Loading project details...
  </div>

  <!-- ERROR -->
  <div *ngIf="errorMessage && !isLoading" class="error">
    {{ errorMessage }}
  </div>

  <!-- CONTENT -->
  <div *ngIf="!isLoading && project" class="project-card">

    <div class="header">
      <h1>{{ project.title }}</h1>
      <span class="status"
        [ngClass]="{
          'open': project.status === 'OPEN',
          'progress': project.status === 'IN_PROGRESS',
          'done': project.status === 'COMPLETED',
          'cancel': project.status === 'CANCELLED'
        }">
        {{ project.status }}
      </span>
    </div>

    <p class="category">
      <strong>Category:</strong>
      {{ project.category || 'Not specified' }}
    </p>

    <p class="budget">
      <strong>Budget:</strong>
      ${{ project.budget }}
    </p>

    <p class="deadline">
      <strong>Deadline:</strong>
      {{ project.deadline | date:'longDate' }}
    </p>

    <div class="description">
      <strong>Description:</strong>
      <p>{{ project.description }}</p>
    </div>

    <div class="skills">
      <strong>Skills Required:</strong>

      <div class="skills-list" *ngIf="getSkills().length > 0; else noSkills">
        <span class="skill" *ngFor="let skill of getSkills()">
          {{ skill }}
        </span>
      </div>

      <ng-template #noSkills>
        <span class="no-skills">No skills specified</span>
      </ng-template>
    </div>

    <!-- Actions: Back + Edit -->
    <div class="actions">
      <a routerLink="../.." class="btn-back">‚Üê Back to projects</a>
      <a class="btn-edit" 
        *ngIf="userRole === 'FREELANCER'" 
        [routerLink]="['/dashboard/my-applications/add', project.id]">
          Apply
      </a>
    </div>

  </div>

</section>


<section *ngIf="userRole === 'CLIENT' || userRole === 'ADMIN'" class="applications-section">
  <h2>Applications for this Project</h2>

  <div *ngIf="isLoadingApplications" class="loading">
    Loading applications...
  </div>

  <div *ngIf="!isLoadingApplications && applications.length === 0" class="no-applications">
    No applications yet.
  </div>

  <div *ngFor="let app of applications" class="application-card">
    <p><strong>Freelancer:</strong> {{ usersMap[app.freelanceId]?.firstName }} {{ usersMap[app.freelanceId]?.lastName }}</p>
    <p><strong>Proposed Price:</strong> ${{ app.proposedPrice }}</p>
    <p><strong>Proposed Duration:</strong> {{ app.proposedDuration }} day(s)</p>
    <p><strong>Cover Letter:</strong> {{ app.coverLetter }}</p>
    <p><strong>Status:</strong> <span [ngClass]="app.status?.toLowerCase()">{{ app.status }}</span></p>
    <p *ngIf="app.respondedAt">
      <strong>Responded At:</strong>
      {{ app.respondedAt | date:'yyyy-MM-dd HH:mm' }}
    </p>
    
    <div class="application-actions" *ngIf="userRole === 'CLIENT'">
      <button class="btn-accept" (click)="changeApplicationStatus(app, 'ACCEPTED')" [disabled]="app.status !== 'PENDING'">Accept</button>
      <button class="btn-reject" (click)="changeApplicationStatus(app, 'REJECTED')" [disabled]="app.status !== 'PENDING'">Reject</button>
    </div>
  </div>
</section>